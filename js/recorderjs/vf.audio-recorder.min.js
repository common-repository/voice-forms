(function(t){var n=vfWorkerPath,e=function(t,e){function o(t,n){if(null==t)return n;let e=(4*t+n)/5;return e}function r(){try{if(null!=v){var t=v.className||"";-1!=t.indexOf("listening")&&v.click()}}catch(t){console.log("vf Error: Unable to reset Mic button.")}}var a=e||{},i=a.bufferLen||4096;this.context=t.context;var c=t.context.createAnalyser();t.connect(c),c.fftSize=2048;let l=null,s=null,u=null,f=null,d=!1,h=0,p=0,v=null,g="",m=17;this.context.createScriptProcessor?this.node=this.context.createScriptProcessor(i,2,2):this.node=this.context.createJavaScriptNode(i,2,2);var x=new Worker(a.workerPath||n);x.postMessage({command:"init",config:{sampleRate:this.context.sampleRate}});var w,b=!1;this.node.onaudioprocess=function(t){if(b){"textarea"==g.toLowerCase()&&(m=40);var n=new Uint8Array(c.frequencyBinCount);c.getByteFrequencyData(n);var e=0;for(let t=0;t<n.length;t++)e+=n[t];s=o(s,e),s=parseInt(s),null==u?u=s:s<u&&(u=s),null==f?f=s:s>f&&(f=s,f>2*u&&(d=!0)),l+10<s&&(p=0,h+=1),l-10>s&&(h=0,p+=1),l=s,p>m&&d&&r(),x.postMessage({command:"record",buffer:[t.inputBuffer.getChannelData(0),t.inputBuffer.getChannelData(1)]})}},this.configure=function(t){for(var n in t)t.hasOwnProperty(n)&&(a[n]=t[n])},this.record=function(t=null,n=""){b=!0,v=t,g=n},this.stop=function(){b=!1,l=null,h=0,p=0,s=null,u=null,f=null,d=!1},this.clear=function(){vfMicButtonInCtx=null,x.postMessage({command:"clear"})},this.getBuffers=function(t){w=t||a.callback,x.postMessage({command:"getBuffers"})},this.exportWAV=function(t,n){if(w=t||a.callback,n=n||a.type||"audio/wav",!w)throw new Error("Callback not set");x.postMessage({command:"exportWAV",type:n})},this.exportMonoWAV=function(t,n){if(w=t||a.callback,n=n||a.type||"audio/wav",!w)throw new Error("Callback not set");x.postMessage({command:"exportMonoWAV",type:n})},this.convertBlobToBase64=function(t){return new Promise(function(n,e){if(!(void 0!==t&&t&&t instanceof Blob))return void e(null);let o=new FileReader;o.readAsDataURL(t),o.onload=function(){let t=o.result;void 0!==t&&t&&-1!==t.indexOf(",")?n(t.split(",")[1]):e(null)},o.onerror=function(t){o.abort()},o.onabort=function(){e(null)}})},x.onmessage=function(t){var n=t.data;w(n)},c.connect(this.node),this.node.connect(this.context.destination)};t.Recorder=e})(window);